From 63fc12a51ee0b1b7445e75a102cf5b5fa6995887 Mon Sep 17 00:00:00 2001
From: Collin May <mayco@uw.edu>
Date: Mon, 21 Mar 2022 16:06:11 -0700
Subject: [PATCH 3/3] Add mtd-ram device to bp-1hart device tree

---
 arch/riscv/boot/dts/blackparrot/bp-1hart.dts | 16 +++++++++++++++-
 arch/riscv/boot/dts/blackparrot/bp-4hart.dts |  2 +-
 2 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/arch/riscv/boot/dts/blackparrot/bp-1hart.dts b/arch/riscv/boot/dts/blackparrot/bp-1hart.dts
index d78f6a91e277..7be2ae7ed982 100644
--- a/arch/riscv/boot/dts/blackparrot/bp-1hart.dts
+++ b/arch/riscv/boot/dts/blackparrot/bp-1hart.dts
@@ -7,7 +7,7 @@
 	compatible = "ucbbar,spike-bare-dev";
 	model = "ucbbar,spike-bare";
         chosen {
-                bootargs = "console=hvc0 earlycon=sbi";
+                bootargs = "console=hvc0 earlycon=sbi root=/dev/mtdblock0";
         };
 	cpus {
 		#address-cells = <1>;
@@ -34,6 +34,14 @@
 		device_type = "memory";
 		reg = <0x0 0x80000000 0x0 0x04000000>;
 	};
+	reserved-memory {
+		#address-cells = <2>;
+		#size-cells = <2>;
+		ranges;
+		flash_reserved: flash@84000000 {
+			reg = <0x0 0x84000000 0x0 0x04000000>;
+		};
+	};
 	soc {
 		#address-cells = <2>;
 		#size-cells = <2>;
@@ -46,6 +54,12 @@
 			>;
 			reg = <0x0 0x300000 0x0 0xc0000>;
 		};
+		flash@84000000 {
+			compatible = "mtd-ram";
+			bank-width = <1>;
+			memory-region = <&flash_reserved>;
+			reg = <0x0 0x84000000 0x0 0x04000000>;
+		};
 	};
 	htif {
 		compatible = "ucb,htif0";
diff --git a/arch/riscv/boot/dts/blackparrot/bp-4hart.dts b/arch/riscv/boot/dts/blackparrot/bp-4hart.dts
index 32c8cc3fde97..1ebb6427108b 100644
--- a/arch/riscv/boot/dts/blackparrot/bp-4hart.dts
+++ b/arch/riscv/boot/dts/blackparrot/bp-4hart.dts
@@ -7,7 +7,7 @@
 	compatible = "ucbbar,spike-bare-dev";
 	model = "ucbbar,spike-bare";
         chosen {
-                bootargs = "console=hvc0 earlycon=sbi";
+                bootargs = "console=hvc0 earlycon=sbi root=/dev/mtdblock0";
         };
 	cpus {
 		#address-cells = <1>;
-- 
2.16.5

